import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.annotation.WebServlet;
import java.sql.*;

@WebServlet("/servlet/Insert2")
public class Insert2 extends HttpServlet
{
    public void service( HttpServletRequest req, HttpServletResponse res)
	throws ServletException, IOException
    {
        PrintWriter out = res.getWriter();
	res.setContentType( "text/html" );
	out.println("<HTML><HEAD><TITLE>Select</TITLE></HEAD><BODY><TABLE border =\"1\">");
	try{
	    Connection con=null;
	    Statement stmt;
	    Class.forName("org.postgresql.Driver");
	    String url = "jdbc:postgresql://psqlserv/n3p1";
	    String nom = "massiaua";
	    String mdp = "moi";
	    con = DriverManager.getConnection(url,nom,mdp);
	    stmt = con.createStatement();
	    String table = req.getParameter("table");
	    String query = "select * FROM "+table;
	    ResultSet rs = stmt.executeQuery(query);
	    ResultSetMetaData rsmd = rs.getMetaData();

	    int nbCols = rsmd.getColumnCount();
		
	    out.println("<h1>Liste des "+table+":</h1>");
	    
	    while (rs.next())
		{
		    out.println("<tr>");
		    for(int i=1; i<=nbCols; i++){
			out.println("<td>"+rs.getString(rsmd.getColumnName(i))+"</td>");
		    }
		    out.println("</tr>");
		}
	    con.close();
	    out.println("</TABLE></BODY></HTML>");
	}catch(Exception e){
	    out.println(e.getMessage());
	}
    }
}
